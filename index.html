    <!DOCTYPE html>
    <html lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <title>–ì–æ—Ä–æ–¥—Å–∫–æ–π –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</title>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                -webkit-tap-highlight-color: transparent;
                touch-action: none;
                -webkit-touch-callout: none;
                -webkit-user-select: none;
                user-select: none;
            }

            html, body {
                overflow: hidden;
                position: fixed;
                width: 100%;
                height: 100%;
                background-color: white;
            }

            body {
                display: flex;
                flex-direction: column;
            }

            .main-content {
                flex: 1;
                display: flex;
                flex-direction: column;
                padding: 4vh 6vw;
                gap: 10vh;
                height: 100%;
                overflow: hidden;
            }

            #code-input {
                display: flex;
                justify-content: center;
                gap: 2vw;
                margin-top: 4vh;
            }

            #code-input span {
                width: min(14vw, 18vh);
                height: min(16vw, 20vh);
                border: 1.5px solid #D1D1D6;
                border-radius: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: white;
            }

            #code-input input {
                width: 100%;
                height: 100%;
                font-size: min(8vw, 10vh);
                font-weight: 400;
                text-align: center;
                border: none;
                background: none;
                color: #000;
                outline: none;
                padding: 0;
                pointer-events: none;
            }

            .input-caption {
                display: flex;
                align-items: flex-start;
                justify-content: center;
                gap: 2vw;
                color: rgba(0, 0, 0, 1);
                font-size: min(7vw, 8vh);
                font-weight: 600;
                margin-bottom: 4vh;
                text-align: center;
                line-height: 1.2;
            }

            .input-caption svg {
                width: min(7vw, 8vh);
                height: min(7vw, 8vh);
                color: rgba(0, 0, 0, 1);
                margin-top: 0.3vh;
            }

            .keyboard-container {
                background: #F2F2F7;
                border-radius: 12px;
                padding: 2vh 6vw;
                margin: 0;
            }

            .keyboard {
                width: 100%;
                margin: 0;
            }

            .keyboard-row {
                display: flex;
                justify-content: center;
                gap: 2vw;
                margin-bottom: 2vw;
            }

            .keyboard-row:last-child {
                margin-bottom: 0;
            }

            .key {
                flex: 1;
                height: min(16vw, 20vh);
                background: white;
                border: none;
                border-radius: 4px;
                font-size: min(9vw, 11vh);
                color: #000;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                font-weight: 400;
            }

            .key.function {
                font-size: min(4vw, 5vh);
                flex-direction: column;
                gap: 0.5vh;
            }

            .key.function svg {
                width: min(8vw, 10vh);
                height: min(8vw, 10vh);
                margin-top: 0.5vh;
            }

            #error-message {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(227, 30, 36, 0.9);
                color: white;
                padding: 2vh 4vw;
                border-radius: 12px;
                font-size: min(3.5vw, 4.5vh);
                display: none;
                z-index: 1000;
                text-align: center;
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .key.backspace {
                font-size: min(7vw, 9vh);
            }
        </style>
    </head>
    <body>
        <div class="main-content">
            <div id="code-input">
                <span><input readonly inputmode="none"></span>
                <span><input readonly inputmode="none"></span>
                <span><input readonly inputmode="none"></span>
                <span><input readonly inputmode="none"></span>
                <span><input readonly inputmode="none"></span>
                <span><input readonly inputmode="none"></span>
            </div>

            <div class="input-caption">
                <svg viewBox="0 0 448 480" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill="currentColor" d="M104 103.1C112.8 103.1 120 111.2 120 119.1V135.1C120 144.8 112.8 151.1 104 151.1H88C79.16 151.1 72 144.8 72 135.1V119.1C72 111.2 79.16 103.1 88 103.1H104zM0 79.1C0 53.49 21.49 31.1 48 31.1H144C170.5 31.1 192 53.49 192 79.1V175.1C192 202.5 170.5 223.1 144 223.1H48C21.49 223.1 0 202.5 0 175.1V79.1zM48 175.1H144V79.1H48V175.1zM72 375.1C72 367.2 79.16 359.1 88 359.1H104C112.8 359.1 120 367.2 120 375.1V391.1C120 400.8 112.8 407.1 104 407.1H88C79.16 407.1 72 400.8 72 391.1V375.1zM0 335.1C0 309.5 21.49 287.1 48 287.1H144C170.5 287.1 192 309.5 192 335.1V431.1C192 458.5 170.5 479.1 144 479.1H48C21.49 479.1 0 458.5 0 431.1V335.1zM48 431.1H144V335.1H48V431.1zM360 103.1C368.8 103.1 376 111.2 376 119.1V135.1C376 144.8 368.8 151.1 360 151.1H344C335.2 151.1 328 144.8 328 135.1V119.1C328 111.2 335.2 103.1 344 103.1H360zM400 31.1C426.5 31.1 448 53.49 448 79.1V175.1C448 202.5 426.5 223.1 400 223.1H304C277.5 223.1 256 202.5 256 175.1V79.1C256 53.49 277.5 31.1 304 31.1H400zM400 79.1H304V175.1H400V79.1zM384 479.1H352V447.1H384V479.1zM416 447.1H448V479.1H416V447.1zM448 415.1H352V383.1H320V479.1H256V287.1H352V319.1H416V287.1H448V415.1z"/>
                </svg>
                –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ —Å –Ω–∞–∫–ª–µ–π–∫–∏
            </div>

            <div class="keyboard-container">
                <div class="keyboard">
                    <div class="keyboard-row">
                        <button class="key">1</button>
                        <button class="key">2</button>
                        <button class="key">3</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="key">4</button>
                        <button class="key">5</button>
                        <button class="key">6</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="key">7</button>
                        <button class="key">8</button>
                        <button class="key">9</button>
                    </div>
                    <div class="keyboard-row">
                        <button class="key function">
                            –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å
                            <svg viewBox="0 0 448 480" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill="currentColor" d="M104 103.1C112.8 103.1 120 111.2 120 119.1V135.1C120 144.8 112.8 151.1 104 151.1H88C79.16 151.1 72 144.8 72 135.1V119.1C72 111.2 79.16 103.1 88 103.1H104zM0 79.1C0 53.49 21.49 31.1 48 31.1H144C170.5 31.1 192 53.49 192 79.1V175.1C192 202.5 170.5 223.1 144 223.1H48C21.49 223.1 0 202.5 0 175.1V79.1zM48 175.1H144V79.1H48V175.1zM72 375.1C72 367.2 79.16 359.1 88 359.1H104C112.8 359.1 120 367.2 120 375.1V391.1C120 400.8 112.8 407.1 104 407.1H88C79.16 407.1 72 400.8 72 391.1V375.1zM0 335.1C0 309.5 21.49 287.1 48 287.1H144C170.5 287.1 192 309.5 192 335.1V431.1C192 458.5 170.5 479.1 144 479.1H48C21.49 479.1 0 458.5 0 431.1V335.1zM48 431.1H144V335.1H48V431.1zM360 103.1C368.8 103.1 376 111.2 376 119.1V135.1C376 144.8 368.8 151.1 360 151.1H344C335.2 151.1 328 144.8 328 135.1V119.1C328 111.2 335.2 103.1 344 103.1H360zM400 31.1C426.5 31.1 448 53.49 448 79.1V175.1C448 202.5 426.5 223.1 400 223.1H304C277.5 223.1 256 202.5 256 175.1V79.1C256 53.49 277.5 31.1 304 31.1H400zM400 79.1H304V175.1H400V79.1zM384 479.1H352V447.1H384V479.1zM416 447.1H448V479.1H416V447.1zM448 415.1H352V383.1H320V479.1H256V287.1H352V319.1H416V287.1H448V415.1z"/>
                            </svg>
                        </button>
                        <button class="key">0</button>
                        <button class="key backspace">‚å´</button>
                    </div>
                </div>
            </div>

            <div id="error-message">–ö–æ–¥ –Ω–µ–≤–µ—Ä–Ω—ã–π</div>
        </div>

        <script>
            let code = "";
            const inputs = document.querySelectorAll('#code-input input');
            const errorMessage = document.getElementById('error-message');
            const BASE_WEB_APP_URL = "https://competidora-cmd.github.io/telegram-mini-app/";

            function addDigit(digit) {
                if (code.length < 6) {
                    code += digit;
                    updateDisplay();
                    if (code.length === 6) {
                        checkCode();
                    }
                }
            }

            async function checkCode() {
                try {
                    console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:', code);
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –±–∏–ª–µ—Ç–æ–≤
                    const response = await fetch('tickets.json');
                    const data = await response.json();
                    
                    // –ò—â–µ–º –∫–æ–¥ –±–∏–ª–µ—Ç–∞ –≤–æ –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–∞—Ö
                    let ticketData = null;
                    let ticketCode = null;
                    
                    for (const [routeNum, route] of Object.entries(data.routes)) {
                        if (route.codes[code]) {
                            ticketCode = route.codes[code];
                            ticketData = {
                                code: ticketCode,
                                carrier: route.carrier,
                                route: `${routeNum}, ${route.name}`,
                                vehicle: route.vehicle,
                                cost: route.cost
                            };
                            break;
                        }
                    }
                    
                    if (ticketData) {
                        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
                        const now = new Date();
                        const purchaseDate = now.toLocaleDateString('ru', { 
                            day: 'numeric', 
                            month: 'long', 
                            year: 'numeric'
                        });
                        const purchaseTime = now.toLocaleTimeString('ru', { 
                            hour: '2-digit', 
                            minute: '2-digit'
                        });

                        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –±–æ—Ç
                        const message = `–ë–∏–ª–µ—Ç –∫—É–ø–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ.\n${ticketData.carrier}\nüöå ${ticketData.route}\nüé´ ${ticketCode}\nüí∞ –¢–∞—Ä–∏—Ñ: –ü–æ–ª–Ω—ã–π ${ticketData.cost} ‚ÇΩ\nüéüÔ∏è –ë–∏–ª–µ—Ç ‚Ññ ${formatTicketNumber(ticketData.code)}\n‚è±Ô∏è –î–µ–π—Å—Ç–≤—É–µ—Ç: 15 —Å–µ–∫.`;
                        
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram WebApp
                        if (window.Telegram && window.Telegram.WebApp) {
                            window.Telegram.WebApp.sendData(JSON.stringify({
                                action: 'ticket_purchased',
                                message: message
                            }));
                        }

                        // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ URL –¥–ª—è ticket.html
                        const ticketUrl = `${BASE_WEB_APP_URL}ticket.html?` +
                            `code=${encodeURIComponent(ticketData.code)}&` +
                            `carrier=${encodeURIComponent(ticketData.carrier)}&` +
                            `route=${encodeURIComponent(ticketData.route)}&` +
                            `vehicle=${encodeURIComponent(ticketData.vehicle)}&` +
                            `cost=${encodeURIComponent(ticketData.cost)}&` +
                            `purchase_date=${encodeURIComponent(purchaseDate)}&` +
                            `purchase_time=${encodeURIComponent(purchaseTime)}`;
                        
                        // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ ticket.html
                        window.location.href = ticketUrl;
                        return;
                    }

                    // –ï—Å–ª–∏ –∫–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                    throw new Error('–ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–¥–∞:', error);
                    errorMessage.style.display = 'block';
                    errorMessage.style.opacity = '1';
                    
                    // –û—á–∏—â–∞–µ–º –∫–æ–¥ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    code = '';
                    updateDisplay();
                    
                    // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
                    setTimeout(() => {
                        errorMessage.style.opacity = '0';
                        setTimeout(() => {
                            errorMessage.style.display = 'none';
                        }, 300);
                    }, 1000);
                }
            }

            function resetCode() {
                code = code.slice(0, -1);
                updateDisplay();
            }

            function updateDisplay() {
                inputs.forEach((input, index) => {
                    input.value = code[index] || '';
                    input.parentElement.classList.toggle('has-value', !!code[index]);
                });
            }

            document.querySelectorAll('.key').forEach(button => {
                const skbtn = button.textContent;
                if (skbtn && !isNaN(skbtn)) {
                    button.addEventListener('click', () => addDigit(skbtn));
                } else if (skbtn === '‚å´') {
                    button.addEventListener('click', resetCode);
                } else if (skbtn === '–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å') {
                    button.addEventListener('click', () => alert('–§—É–Ω–∫—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞'));
                }
            });

            Telegram.WebApp.ready();
        </script>
    </body>
    </html>
