// ... existing code ...
        async function checkCode() {
            try {
                console.log('Проверка кода:', code);
                
                // Загружаем данные билетов
                const response = await fetch('codes.json');
                const tickets = await response.json();
                
                // Проверяем существование кода
                if (tickets[code]) {
                    const ticketData = tickets[code];
                    // Текущая дата и время
                    const now = new Date();
                    const purchaseDate = now.toLocaleDateString('ru', { 
                        day: 'numeric', 
                        month: 'long', 
                        year: 'numeric'
                    });
                    const purchaseTime = now.toLocaleTimeString('ru', { 
                        hour: '2-digit', 
                        minute: '2-digit'
                    });

                    // Формирование URL для ticket.html
                    const ticketUrl = `${BASE_WEB_APP_URL}ticket.html?` +
                        `code=${encodeURIComponent(ticketData.code)}&` +
                        `carrier=${encodeURIComponent(ticketData.carrier)}&` +
                        `route=${encodeURIComponent(ticketData.route)}&` +
                        `vehicle=${encodeURIComponent(ticketData.vehicle)}&` +
                        `cost=${encodeURIComponent(ticketData.cost)}&` +
                        `purchase_date=${encodeURIComponent(purchaseDate)}&` +
                        `purchase_time=${encodeURIComponent(purchaseTime)}`;
                    
                    // Перенаправление на ticket.html
                    window.location.href = ticketUrl;
                    return;
                }

                // Если код не найден, показываем ошибку
                throw new Error('Код не найден');
            } catch (error) {
                console.error('Ошибка при проверке кода:', error);
                const errorMessage = document.getElementById('error-message');
                errorMessage.style.display = 'block';
                errorMessage.style.opacity = '1';
                
                // Очищаем код и обновляем отображение
                code = '';
                updateDisplay();
                
                // Скрываем сообщение об ошибке через 1 секунду
                setTimeout(() => {
                    errorMessage.style.opacity = '0';
                    setTimeout(() => {
                        errorMessage.style.display = 'none';
                    }, 300);
                }, 1000);
            }
        }
// ... existing code ...
