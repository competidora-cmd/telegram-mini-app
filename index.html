<!DOCTYPE html>

<html lang="ru">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Конструктор билетов</title>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>

        * {

            margin: 0;

            padding: 0;

            box-sizing: border-box;

            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;

        }



        body {

            background: #fff;

            color: #000;

            padding: 20px;

        }



        .form-group {

            margin-bottom: 20px;

        }



        label {

            display: block;

            margin-bottom: 8px;

            color: #8E8E93;

            font-size: 15px;

        }



        input, select {

            width: 100%;

            padding: 12px;

            border: 1px solid #E0E0E0;

            border-radius: 10px;

            font-size: 17px;

            color: #000;

            background: #fff;

            -webkit-appearance: none;

        }



        select {

            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%238E8E93' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

            background-repeat: no-repeat;

            background-position: right 12px center;

            background-size: 16px;

            padding-right: 40px;

        }



        button {

            width: 100%;

            padding: 16px;

            background: #E31E24;

            color: white;

            border: none;

            border-radius: 14px;

            font-size: 17px;

            font-weight: 500;

            margin-top: 20px;

            cursor: pointer;

        }



        .header {

            font-size: 20px;

            font-weight: 600;

            margin-bottom: 24px;

            text-align: center;

        }

    </style>

</head>

<body>
    <div class="header">Конструктор билетов</div>
    
    <form id="ticketForm">
        <div class="form-group">
            <label>Перевозчик</label>
            <select id="carrier" required>
                <option value="ИП Патрин Н. Н.">ИП Патрин Н. Н.</option>
                <option value="КПАТП-7">КПАТП-7</option>
            </select>
        </div>

        <div class="form-group">
            <label>Маршрут</label>
            <select id="route" required>
                <option value="Красфарма (60 лет Октября) - Х/К Енисей">Красфарма (60 лет Октября) - Х/К Енисей</option>
                <option value="пос. Водников-Железнодорожный вокзал">пос. Водников-Железнодорожный вокзал</option>
                <option value="Северный-Цимлянская">Северный-Цимлянская</option>
            </select>
        </div>

        <div class="form-group">
            <label>Гос. номер</label>
            <input type="text" id="vehicle" required placeholder="Например: р471тм124">
        </div>

        <div class="form-group">
            <label>Стоимость</label>
            <select id="cost" required>
                <option value="40.00">40.00₽</option>
                <option value="44.00">44.00₽</option>
            </select>
        </div>

        <button type="submit">СОЗДАТЬ БИЛЕТ</button>
    </form>

    <script>
        window.Telegram.WebApp.ready();
        window.Telegram.WebApp.expand();

        function generateTicketCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        function getCurrentDateTime() {
            const now = new Date();
            const date = now.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });
            const time = now.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit'
            });
            return { date, time };
        }

        document.getElementById('ticketForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const { date, time } = getCurrentDateTime();
            const ticketCode = generateTicketCode();

            const ticketData = {
                carrier: document.getElementById('carrier').value,
                route: document.getElementById('route').value,
                vehicle: document.getElementById('vehicle').value.toLowerCase(),
                cost: document.getElementById('cost').value,
                code: ticketCode,
                purchase_date: date,
                purchase_time: time
            };

            // Отправляем данные в бот для обновления tickets.json
            window.Telegram.WebApp.sendData(JSON.stringify(ticketData));
        });
    </script>
</body>

</html>

